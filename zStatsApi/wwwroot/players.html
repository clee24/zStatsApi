<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Players</title>
</head>
<body>
<h1>Players</h1>

<table border="1" id="playersTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Rank</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<h2 id="formTitle">Add New Player</h2>
<form id="playerForm">
    <input type="hidden" id="playerId">
    <label>
        Name:
        <input type="text" id="playerName" required>
    </label>
    <br>
    <label>
        Rank:
        <select id="playerRank" required>
            <option value="">Select Rank</option>
            <option value="1">AA</option>
            <option value="2">A</option>
            <option value="3">BB</option>
            <option value="4">B</option>
            <option value="5">C</option>
        </select>
    </label>
    <br>
    <button type="submit">Save Player</button>
    <button type="button" id="cancelEdit" style="display:none;">Cancel</button>
</form>

<script>
    const apiBase = "/players";
    let editingId = null;

    async function loadPlayers() {
        const res = await fetch(apiBase);
        const players = await res.json();

        const tbody = document.querySelector("#playersTable tbody");
        tbody.innerHTML = "";

        players.forEach(p => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${p.id}</td>
                <td>${p.name}</td>
                <td>${p.rank}</td>
                <td></td>
            `;

            const editBtn = document.createElement("button");
            editBtn.textContent = "Edit";
            editBtn.addEventListener("click", () => editPlayer(p.id, p.name, p.rank));
            row.cells[3].appendChild(editBtn);

            tbody.appendChild(row);
        });
    }

    async function savePlayer(e) {
        e.preventDefault();
        const name = document.getElementById("playerName").value;
        const rank = parseInt(document.getElementById("playerRank").value);

        if (!rank) {
            alert("Please select a rank.");
            return;
        }

        const method = editingId ? "PUT" : "POST";
        const url = editingId ? `${apiBase}/${editingId}` : apiBase;

        await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, rank })
        });

        resetForm();
        loadPlayers();
    }

    function editPlayer(id, name, rank) {
        editingId = id;
        document.getElementById("playerId").value = id;
        document.getElementById("playerName").value = name;
        document.getElementById("playerRank").value = rank;
        document.getElementById("formTitle").textContent = "Edit Player";
        document.getElementById("cancelEdit").style.display = "inline";
    }

    function resetForm() {
        editingId = null;
        document.getElementById("playerForm").reset();
        document.getElementById("formTitle").textContent = "Add New Player";
        document.getElementById("cancelEdit").style.display = "none";
    }

    document.getElementById("playerForm").addEventListener("submit", savePlayer);
    document.getElementById("cancelEdit").addEventListener("click", resetForm);

    loadPlayers();
</script>
</body>
</html>
